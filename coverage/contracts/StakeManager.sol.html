<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/StakeManager.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> StakeManager.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">60.61% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>40/66</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">43.33% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>13/30</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">58.33% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>7/12</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">54.43% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>43/79</span>
      </div>
    </div>
  </div>
  <div class='status-line medium'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity 0.8.16;
&nbsp;
import "@openzeppelin/contracts/utils/math/SafeMath.sol";
import "@openzeppelin/contracts/security/Pausable.sol";
import "@openzeppelin/contracts/access/AccessControl.sol";
import "@openzeppelin/contracts/security/ReentrancyGuard.sol";
// import "hardhat/console.sol";
&nbsp;
error StakeManager__StakeLimitExceeded();
error StakeManager__StakeIsZero();
error StakeManager__TransactionFailed();
error StakeManager__InsufficientBalance();
error StakeManager__ContractUpdateWindowIsOpen();
error StakeManager__ContractUpdateWindowIsNotOpen();
error StakeManager__StakeHolderDoesNotExist();
error StakeManager__StakeHolderAlreadyExists();
&nbsp;
/// @title An Ethereum Token Purse to distribute funds to beneficiaries.
/// @dev There are a total of 1,000,000,000 unit of shares.
/// @custom:security-contact abolaji.adedeji@gmail.com
contract StakeManager is Pausable, AccessControl, ReentrancyGuard {
    using SafeMath for uint256;
&nbsp;
    // FundsReceived event is triggered when funds are recieved to the contract
    event FundsReceived(address indexed addr, uint256 amount);
&nbsp;
    // FundsDistributed is triggered when funds are distributed from the contract
    event FundsDistributed(
        address indexed beneficiary,
        uint256 amount,
        uint256 time_distributed
    );
&nbsp;
    // BeneficiariesAdded is triggered when a new beneficiary is added to the contract
    event BeneficiariesAdded(
        address indexed holder,
        uint256 equityTokens,
        uint256 timeAdded
    );
&nbsp;
    // BeneficiaryStakeIncreased is triggered when an existing beneficiary equity is increased
    event BeneficiaryStakeIncreased(
        address indexed holder,
        uint256 equityTokens,
        uint256 timeAdded
    );
&nbsp;
    // Roles
    bytes32 public constant PAUSER_ROLE = keccak256("PAUSER_ROLE");
    bytes32 public constant MANAGER_ROLE = keccak256("MANAGER_ROLE");
&nbsp;
    // Stake struct manages an equity of each specific beneficiary
    struct Stake {
        uint256 equityTokens;
        uint256 fundsLastReceived;
        uint256 equityLastUpdated;
    }
&nbsp;
    // list of beneficiaries addresses
    address[] public beneficiariesAddresses;
&nbsp;
    // beneficiaries maps address to Stake of current beneficiaries
    mapping(address =&gt; Stake) public beneficiaries;
&nbsp;
    // the address of the company treasury
    address payable public companyTreasuryAddress;
&nbsp;
    // intervalSeconds is the number of seconds of the update windows e.g 30 days
    uint256 public immutable intervalSeconds;
    // updateWindowSeconds is number of seconds the interval of each update e.g 7 days
    uint256 public immutable updateWindowSeconds;
    // maxStake is the total stake in the purse
    uint256 private immutable maxStake = 10 ** 9;
    // lastEndOfWindowTimestamp is the last time stamp of when the interval ended in seconds
    uint256 public lastEndOfIntervalTimestamp;
    // currentTotalStake keeps track of the total beneficiary stakes
    uint256 public currentTotalStake = 0;
&nbsp;
    constructor(address _companyTreasury, uint256 _interval, uint256 _window) {
        // grant roles to deployer address
        _grantRole(DEFAULT_ADMIN_ROLE, msg.sender);
        _grantRole(PAUSER_ROLE, msg.sender);
        _grantRole(MANAGER_ROLE, msg.sender);
&nbsp;
        // set the companyTreasury address
        setCompanyTreasuryAddress(_companyTreasury);
&nbsp;
        // set the interval and window and current end of interval timestamp
        intervalSeconds = _interval;
        updateWindowSeconds = _window;
        lastEndOfIntervalTimestamp = block.timestamp;
    }
&nbsp;
    /// @notice Distrbute funds to beneficiaries and remainder to Company Treasury
<span class="fstat-no" title="function not covered" >    function distributeFunds() public whenNotPaused nonReentrant {</span>
<span class="cstat-no" title="statement not covered" >        if (withinUpdateWindow()) {</span>
            revert StakeManager__ContractUpdateWindowIsOpen();
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        uint256 fundsToDistribute = address(this).balance;</span>
<span class="cstat-no" title="statement not covered" >        uint256 fundsDistributed = 0;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        if (fundsToDistribute == 0) {</span>
            revert StakeManager__InsufficientBalance();
        }
<span class="cstat-no" title="statement not covered" >        address[] memory currentHolderAddresses = beneficiariesAddresses;</span>
<span class="cstat-no" title="statement not covered" >        for (uint256 i = 0; i &lt; currentHolderAddresses.length; ++i) {</span>
            // calculate amount to distribute
<span class="cstat-no" title="statement not covered" >            uint256 equityTokens = beneficiaries[currentHolderAddresses[i]]</span>
                .equityTokens;
<span class="cstat-no" title="statement not covered" >            uint256 amount = fundsToDistribute.mul(equityTokens).div(maxStake);</span>
&nbsp;
            // update funds last received with timestamp
<span class="cstat-no" title="statement not covered" >            beneficiaries[currentHolderAddresses[i]].fundsLastReceived = block</span>
                .timestamp;
<span class="cstat-no" title="statement not covered" >            fundsDistributed += amount</span>;
&nbsp;
            // send value to beneficiary
<span class="cstat-no" title="statement not covered" >            sendValue(payable(beneficiariesAddresses[i]), amount)</span>;
<span class="cstat-no" title="statement not covered" >            emit FundsDistributed(</span>
                beneficiariesAddresses[i],
                amount,
                block.timestamp
            );
        }
&nbsp;
        // update last timestamp with previous timestamp plus interval
<span class="cstat-no" title="statement not covered" >        (, uint256 _closetimestamp) = getUpdateWindow();</span>
<span class="cstat-no" title="statement not covered" >        if (block.timestamp &gt;= _closetimestamp) {</span>
<span class="cstat-no" title="statement not covered" >            lastEndOfIntervalTimestamp += intervalSeconds</span>;
        } else {
<span class="cstat-no" title="statement not covered" >            lastEndOfIntervalTimestamp = lastEndOfIntervalTimestamp</span>;
        }
&nbsp;
        // send remaining funds to company treasury fund address
<span class="cstat-no" title="statement not covered" >        sendValue(companyTreasuryAddress, address(this).balance)</span>;
<span class="cstat-no" title="statement not covered" >        emit FundsDistributed(</span>
            companyTreasuryAddress,
            fundsDistributed,
            block.timestamp
        );
    }
&nbsp;
    /// @notice Updates an existing beneficiary with a specific stake increase
    /// @param _holder The address of the existing beneficiary
    /// @param _stakeIncrease The amount to increase the equity tokens by
    function updateBeneficiariesStake(
        address _holder,
        uint256 _stakeIncrease
    ) public whenNotPaused onlyRole(MANAGER_ROLE) {
        // only continue if the update window is open
        <span class="missing-if-branch" title="if path not taken" >I</span>if (!withinUpdateWindow()) {
            revert StakeManager__ContractUpdateWindowIsNotOpen();
        }
&nbsp;
        // check if the stake is zero
        <span class="missing-if-branch" title="if path not taken" >I</span>if (_stakeIncrease &lt;= 0) {
            revert StakeManager__StakeIsZero();
        }
&nbsp;
        // check if the new total stake is greater than maximum limit
        uint256 newTotalStake = currentTotalStake.add(_stakeIncrease);
        <span class="missing-if-branch" title="if path not taken" >I</span>if (newTotalStake &gt; maxStake) {
            revert StakeManager__StakeLimitExceeded();
        }
&nbsp;
        // check if beneficiary exists
        <span class="missing-if-branch" title="if path not taken" >I</span>if (beneficiaries[_holder].equityTokens &lt;= 0) {
            revert StakeManager__StakeHolderDoesNotExist();
        }
&nbsp;
        // Updating equities of existing beneficiaries
        uint256 newStake = beneficiaries[_holder].equityTokens.add(
            _stakeIncrease
        );
        beneficiaries[_holder].equityTokens = newStake;
        beneficiaries[_holder].equityLastUpdated = block.timestamp;
        currentTotalStake += _stakeIncrease;
&nbsp;
        // emit beneficiary stake increased event
        emit BeneficiaryStakeIncreased(
            _holder,
            _stakeIncrease,
            block.timestamp
        );
    }
&nbsp;
    /// @notice Adds a new beneficiary with an initial stake
    /// @param _holder The address of the existing beneficiary
    /// @param _initialStake The amount to initialise the preportion of the stake
    function addBeneficiary(
        address _holder,
        uint256 _initialStake
    ) public whenNotPaused onlyRole(MANAGER_ROLE) {
        // only continue if the update window is open
        if (!withinUpdateWindow()) {
            revert StakeManager__ContractUpdateWindowIsNotOpen();
        }
&nbsp;
        // check if the stake is zero
        if (_initialStake &lt;= 0) {
            revert StakeManager__StakeIsZero();
        }
&nbsp;
        // check if the new total stake is greater than the limit
        uint256 newTotalStake = currentTotalStake.add(_initialStake);
        if (newTotalStake &gt; maxStake) {
            revert StakeManager__StakeLimitExceeded();
        }
&nbsp;
        // check if beneficiary already exists
        <span class="missing-if-branch" title="if path not taken" >I</span>if (beneficiaries[_holder].equityTokens != 0) {
            revert StakeManager__StakeHolderAlreadyExists();
        }
&nbsp;
        // add beneficiary to mapping
        beneficiaries[_holder] = Stake(
            _initialStake,
            block.timestamp,
            block.timestamp
        );
        beneficiariesAddresses.push(_holder);
        currentTotalStake += _initialStake;
&nbsp;
        // emit beneficiary added map
        emit BeneficiariesAdded(_holder, _initialStake, block.timestamp);
    }
&nbsp;
    /// @notice Updates the Company Treasury address
    /// @param fund The new address of the Impact 3 fund
    function setCompanyTreasuryAddress(
        address fund
    ) public onlyRole(MANAGER_ROLE) {
        companyTreasuryAddress = payable(fund);
    }
&nbsp;
    /// @notice Returns whether we are within the update window
    /// @return isOpen Whether the window to update or add new beneficiaries is open
    function withinUpdateWindow() public view returns (bool) {
        (uint256 _opentimestamp, uint256 _closetimestamp) = getUpdateWindow();
&nbsp;
        if (
            block.timestamp &gt;= _opentimestamp &amp;&amp;
            block.timestamp &lt; _closetimestamp
        ) {
            return true;
        }
&nbsp;
        return false;
    }
&nbsp;
    /// @notice Calculates the update window intervals
    /// @return openTimestamp The opening timestamp of the update window
    /// @return closeTimestamp The closing timestamp of the update window
    function getUpdateWindow() public view returns (uint256, uint256) {
        uint256 _opentimestamp = lastEndOfIntervalTimestamp + intervalSeconds;
        uint256 _closetimestamp = lastEndOfIntervalTimestamp +
            (intervalSeconds + updateWindowSeconds);
        return (_opentimestamp, _closetimestamp);
    }
&nbsp;
    /// @notice Pauses the contract so no interactions can be made
<span class="fstat-no" title="function not covered" >    function pause() public onlyRole(PAUSER_ROLE) {</span>
<span class="cstat-no" title="statement not covered" >        _pause()</span>;
    }
&nbsp;
    /// @notice Unpauses the contract so interactions can be made
<span class="fstat-no" title="function not covered" >    function unpause() public onlyRole(PAUSER_ROLE) {</span>
<span class="cstat-no" title="statement not covered" >        _unpause()</span>;
    }
&nbsp;
    /// @notice When funds are received by the contract we emit an event
    receive() external payable {
        emit FundsReceived(msg.sender, msg.value);
    }
&nbsp;
    /// @notice Sends an address funds from this contract
    /// @param recipient The address to send funds to
    /// @param amount The amount of funds to send
<span class="fstat-no" title="function not covered" >    function sendValue(address payable recipient, uint256 amount) internal {</span>
<span class="cstat-no" title="statement not covered" >        if (address(this).balance &lt; amount) {</span>
            revert StakeManager__InsufficientBalance();
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        (bool success, ) = recipient.call{value: amount}("");</span>
<span class="cstat-no" title="statement not covered" >        if (!success) {</span>
            revert StakeManager__TransactionFailed();
        }
    }
&nbsp;
    /// @notice Gets all beneficiaries of the contract as well as their stake
    /// @return _holders An array of addresses of the beneficiaries
    /// @return _equityTokens An array of equity tokens
    function getBeneficiariesAddresses()
        external
        view
        returns (address[] memory _holders, uint256[] memory _equityTokens)
    {
        _holders = new address[](beneficiariesAddresses.length);
        _holders = beneficiariesAddresses;
&nbsp;
        _equityTokens = new uint256[](_holders.length);
        for (uint256 i = 0; i &lt; _holders.length; ++i) {
            _equityTokens[i] = beneficiaries[_holders[i]].equityTokens;
        }
&nbsp;
        return (_holders, _equityTokens);
    }
&nbsp;
    /// @notice Checks whether a specific address is a beneficiary of the contract
    /// @param _holder The address to check
    /// @return isABeneficiary whether or not the address is a beneficiary
<span class="fstat-no" title="function not covered" >    function isABeneficiary(address _holder) external view returns (bool) {</span>
<span class="cstat-no" title="statement not covered" >        if (beneficiaries[_holder].equityTokens &lt;= 0) {</span>
<span class="cstat-no" title="statement not covered" >            return false;</span>
        }
<span class="cstat-no" title="statement not covered" >        return true;</span>
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Sun Jan 29 2023 22:01:37 GMT+0000 (Greenwich Mean Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
